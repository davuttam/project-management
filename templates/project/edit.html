{% extends 'base.html' %}

{% block content %}
   <div class="card">
      <h3>Add New Project</h3>
      <div style="padding: 8px;">
         <div style="display: none;" class="alert alert-success" role="alert">
           Sucessfully Updated the Project.
         </div>
         <form id="post-object-form" class="form-horizontal" novalidate="">
            <fieldset>
               {% csrf_token %}
               <div class="form-group ">
                  <label class="col-sm-2 control-label ">
                  Name
                  </label>
                  <div class="col-sm-10">
                     <input name="name" id="input_name" class="form-control" type="text" value="" required="">
                     <span style="color: red" class="error d-none">This is required Field.</span>
                  </div>
               </div>
               <div class="form-group ">
                  <label class="col-sm-2 control-label ">
                  Description
                  </label>
                  <div class="col-sm-10">
                     <input name="description" id="input_description" class="form-control" type="text" value="" required="">
                     <span style="color: red" class="error d-none">This is required Field.</span>
                  </div>
               </div>
               <div class="form-group ">
                  <label class="col-sm-2 control-label ">
                  Duration
                  </label>
                  <div class="col-sm-10">
                     <input name="duration" id="input_duration" class="form-control" type="number" value="" required="">
                     <span style="color: red" class="error d-none">This is required Field.</span>
                  </div>
               </div>
               <div>
                  <a id="submit" class="btn btn-primary">Update</a>
               </div>
            </fieldset>
         </form>
      </div>
   </div>
{% endblock %}

{% block js_script %}
   $(function() {

      $.get("{% url 'project-detail' project_id %}", function( data ) {
         $("#input_name").val(data.name);
         $("#input_description").val(data.description);
         $("#input_duration").val(data.duration);
      });


      $("#submit").click(function(){
         var is_valid = true;
         $("#post-object-form input").each(function(){
            if (!$(this).val()) {
               $(this).next('.error').removeClass("d-none");
               is_valid = false;
            } else {
               $(this).next('.error').addClass("d-none");
            }
         });
         
         if (!is_valid) {
            return false;
         }
         
         var datastring = $("#post-object-form").serialize();

         $.ajax({
            type: "PUT",
            url: "{% url 'project-detail' project_id %}",
            data: datastring,
            success: function(data, textStatus, xhr) {
               console.log(xhr.status, 'Data send');
               $(".alert-success").slideDown(500).delay(5000).slideUp(500);

            },
            error: function(jqXHR, textStatus, errorThrown){
               console.log(textStatus + ": " + jqXHR.status + " " + errorThrown);
            }
        });
      });
   });
{% endblock %}